# ERP 시스템 프로젝트 분석서

## 1. 프로젝트 개요

### 1.1 프로젝트명
**ERP 마이크로서비스 기반 결재 시스템**

### 1.2 프로젝트 목적
실무 환경에서 사용되는 다양한 통신 방식(REST, gRPC, WebSocket)과 이종 데이터 저장소(MySQL, MongoDB, In-Memory)를 통합하여 엔터프라이즈 자원 관리(ERP) 시스템처럼 동작하는 유연한 마이크로서비스 구조를 구현한다.

### 1.3 프로젝트 범위

#### 1.3.1 포함 범위
- 직원 정보 관리 (CRUD)
- 결재 요청 생성 및 단계 관리
- 결재 승인/반려 처리
- 실시간 알림 시스템

#### 1.3.2 제외 범위
- 사용자 인증/인가 시스템
- 결재 요청 삭제 기능
- 결재 요청 수정 기능

---

## 2. 요구사항 분석

### 2.1 기능적 요구사항

#### FR-001: 직원 관리
| ID | 요구사항 | 우선순위 |
|:---|:---|:---:|
| FR-001-01 | 시스템은 직원 정보(이름, 부서, 직책)를 생성할 수 있어야 한다 | 필수 |
| FR-001-02 | 시스템은 전체 직원 목록을 조회할 수 있어야 한다 | 필수 |
| FR-001-03 | 시스템은 부서/직책별 직원 필터링 조회를 지원해야 한다 | 필수 |
| FR-001-04 | 시스템은 특정 직원의 상세 정보를 조회할 수 있어야 한다 | 필수 |
| FR-001-05 | 시스템은 직원의 부서와 직책만 수정할 수 있어야 한다 | 필수 |
| FR-001-06 | 시스템은 직원 정보를 삭제할 수 있어야 한다 | 필수 |

#### FR-002: 결재 요청 관리
| ID | 요구사항 | 우선순위 |
|:---|:---|:---:|
| FR-002-01 | 시스템은 결재 요청(제목, 내용, 결재 단계)을 생성할 수 있어야 한다 | 필수 |
| FR-002-02 | 결재 요청 생성 시 요청자와 결재자의 존재 여부를 검증해야 한다 | 필수 |
| FR-002-03 | 결재 단계는 1부터 오름차순으로 구성되어야 한다 | 필수 |
| FR-002-04 | 시스템은 전체 결재 요청 목록을 조회할 수 있어야 한다 | 필수 |
| FR-002-05 | 시스템은 특정 결재 요청의 상세 정보를 조회할 수 있어야 한다 | 필수 |

#### FR-003: 결재 처리
| ID | 요구사항 | 우선순위 |
|:---|:---|:---:|
| FR-003-01 | 결재자는 자신에게 할당된 결재 대기 목록을 조회할 수 있어야 한다 | 필수 |
| FR-003-02 | 결재자는 결재 요청을 승인할 수 있어야 한다 | 필수 |
| FR-003-03 | 결재자는 결재 요청을 반려할 수 있어야 한다 | 필수 |
| FR-003-04 | 승인 시 다음 결재 단계로 자동 진행되어야 한다 | 필수 |
| FR-003-05 | 반려 시 즉시 결재가 종료되어야 한다 | 필수 |
| FR-003-06 | 모든 단계 승인 시 최종 승인 상태로 변경되어야 한다 | 필수 |

#### FR-004: 알림
| ID | 요구사항 | 우선순위 |
|:---|:---|:---:|
| FR-004-01 | 시스템은 WebSocket을 통해 실시간 알림을 전송해야 한다 | 필수 |
| FR-004-02 | 최종 승인 완료 시 요청자에게 알림을 전송해야 한다 | 필수 |
| FR-004-03 | 반려 시 요청자에게 반려 알림을 전송해야 한다 | 필수 |
| FR-004-04 | 알림에는 반려자 정보가 포함되어야 한다 | 필수 |

### 2.2 비기능적 요구사항

| ID | 분류 | 요구사항 |
|:---|:---|:---|
| NFR-001 | 확장성 | 각 서비스는 독립적으로 배포 및 확장 가능해야 한다 |
| NFR-002 | 상호운용성 | REST, gRPC, WebSocket 프로토콜을 지원해야 한다 |
| NFR-003 | 데이터 저장 | 서비스별로 적합한 저장소(MySQL, MongoDB, In-Memory)를 사용해야 한다 |
| NFR-004 | 실시간성 | 알림은 WebSocket을 통해 실시간으로 전달되어야 한다 |
| NFR-005 | 컨테이너화 | (선택) 각 서비스는 Docker 컨테이너로 패키징 가능해야 한다 |
| NFR-006 | 오케스트레이션 | (선택) Kubernetes를 통한 배포를 지원해야 한다 |

---

## 3. 유스케이스 분석

### 3.1 액터 정의

| 액터 | 설명 |
|:---|:---|
| **Requester (요청자)** | 결재를 요청하는 직원 |
| **Approver (결재자)** | 결재를 승인/반려하는 직원 |
| **Admin (관리자)** | 직원 정보를 관리하는 관리자 |

### 3.2 유스케이스 목록

```
┌─────────────────────────────────────────────────────────────────┐
│                         ERP 결재 시스템                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────┐                                                  │
│   │  Admin   │──── UC-001: 직원 등록                            │
│   │          │──── UC-002: 직원 정보 수정                        │
│   │          │──── UC-003: 직원 삭제                            │
│   │          │──── UC-004: 직원 목록 조회                        │
│   └──────────┘                                                  │
│                                                                 │
│   ┌──────────┐                                                  │
│   │Requester │──── UC-005: 결재 요청 생성                        │
│   │          │──── UC-006: 결재 요청 조회                        │
│   │          │──── UC-007: 알림 수신                            │
│   └──────────┘                                                  │
│                                                                 │
│   ┌──────────┐                                                  │
│   │ Approver │──── UC-008: 결재 대기 목록 조회                   │
│   │          │──── UC-009: 결재 승인                            │
│   │          │──── UC-010: 결재 반려                            │
│   └──────────┘                                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.3 주요 유스케이스 상세

#### UC-005: 결재 요청 생성

| 항목 | 내용 |
|:---|:---|
| **유스케이스 ID** | UC-005 |
| **유스케이스명** | 결재 요청 생성 |
| **액터** | Requester |
| **선행 조건** | 요청자와 모든 결재자가 시스템에 등록되어 있어야 함 |
| **후행 조건** | 결재 요청이 생성되고, 첫 번째 결재자의 대기 목록에 추가됨 |
| **기본 흐름** | 1. 요청자가 결재 제목, 내용, 결재 단계를 입력한다<br>2. 시스템이 요청자 ID 존재 여부를 검증한다<br>3. 시스템이 모든 결재자 ID 존재 여부를 검증한다<br>4. 시스템이 결재 단계 순서를 검증한다<br>5. 시스템이 결재 요청을 저장한다<br>6. 시스템이 첫 번째 결재자에게 결재 정보를 전달한다 |
| **대안 흐름** | 2a. 요청자 ID가 존재하지 않으면 에러 반환<br>3a. 결재자 ID가 존재하지 않으면 에러 반환<br>4a. 결재 단계가 오름차순이 아니면 에러 반환 |

#### UC-009: 결재 승인

| 항목 | 내용 |
|:---|:---|
| **유스케이스 ID** | UC-009 |
| **유스케이스명** | 결재 승인 |
| **액터** | Approver |
| **선행 조건** | 해당 결재 요청이 결재자의 대기 목록에 존재해야 함 |
| **후행 조건** | 결재 상태가 업데이트되고, 다음 단계로 진행되거나 최종 완료됨 |
| **기본 흐름** | 1. 결재자가 승인 요청을 전송한다<br>2. 시스템이 대기 목록에서 해당 건을 제거한다<br>3. 시스템이 결재 상태를 "approved"로 업데이트한다<br>4a. 다음 결재자가 있으면 다음 결재자 대기 목록에 추가<br>4b. 마지막 단계면 최종 상태를 "approved"로 변경하고 요청자에게 알림 전송 |

---

## 4. 데이터 분석

### 4.1 데이터 엔티티

#### 4.1.1 Employee (직원)
| 속성명 | 데이터 타입 | 필수 | 설명 |
|:---|:---|:---:|:---|
| id | BIGINT | Y | 직원 고유 식별자 (PK, Auto Increment) |
| name | VARCHAR(100) | Y | 직원 이름 |
| department | VARCHAR(100) | Y | 소속 부서 |
| position | VARCHAR(100) | Y | 직책 |
| created_at | DATETIME | Y | 생성 일시 |

#### 4.1.2 ApprovalRequest (결재 요청)
| 속성명 | 데이터 타입 | 필수 | 설명 |
|:---|:---|:---:|:---|
| requestId | Number | Y | 결재 요청 고유 식별자 |
| requesterId | Number | Y | 요청자 직원 ID |
| title | String | Y | 결재 제목 |
| content | String | Y | 결재 내용 |
| steps | Array | Y | 결재 단계 목록 |
| finalStatus | String | Y | 최종 상태 (in_progress, approved, rejected) |
| createdAt | DateTime | Y | 생성 일시 |
| updatedAt | DateTime | N | 수정 일시 |

#### 4.1.3 Step (결재 단계)
| 속성명 | 데이터 타입 | 필수 | 설명 |
|:---|:---|:---:|:---|
| step | Number | Y | 결재 단계 번호 |
| approverId | Number | Y | 결재자 직원 ID |
| status | String | Y | 단계 상태 (pending, approved, rejected) |
| updatedAt | DateTime | N | 처리 일시 |

### 4.2 데이터 흐름

```
┌──────────────┐      ┌──────────────────────┐      ┌─────────────────────┐
│   Client     │      │  Approval Request    │      │ Approval Processing │
│  (Requester) │      │      Service         │      │      Service        │
└──────┬───────┘      └──────────┬───────────┘      └──────────┬──────────┘
       │                         │                              │
       │  POST /approvals        │                              │
       │────────────────────────>│                              │
       │                         │                              │
       │                         │  Validate Employee IDs       │
       │                         │  (REST → Employee Service)   │
       │                         │                              │
       │                         │  Store to MongoDB            │
       │                         │                              │
       │                         │  gRPC: RequestApproval       │
       │                         │─────────────────────────────>│
       │                         │                              │
       │                         │                              │  Store to In-Memory
       │                         │                              │  (approverId → request)
       │                         │                              │
       │                         │<─────────────────────────────│
       │                         │  gRPC: ApprovalResponse      │
       │                         │                              │
       │<────────────────────────│                              │
       │  {"requestId": 1}       │                              │
       │                         │                              │
```

---

## 5. 인터페이스 분석

### 5.1 외부 인터페이스

| 인터페이스 | 프로토콜 | 용도 |
|:---|:---|:---|
| Employee API | REST (HTTP) | 직원 CRUD 작업 |
| Approval Request API | REST (HTTP) | 결재 요청 생성 및 조회 |
| Approval Processing API | REST (HTTP) | 결재 승인/반려 처리 |
| Notification | WebSocket | 실시간 알림 전송 |

### 5.2 내부 인터페이스

| 인터페이스 | 프로토콜 | 송신 서비스 | 수신 서비스 | 용도 |
|:---|:---|:---|:---|:---|
| RequestApproval | gRPC | Approval Request | Approval Processing | 결재 정보 전달 |
| ReturnApprovalResult | gRPC | Approval Processing | Approval Request | 결재 결과 회신 |
| Employee Validation | REST | Approval Request | Employee | 직원 존재 여부 확인 |
| Send Notification | HTTP/WebSocket | Approval Request | Notification | 알림 요청 |

---

## 6. 제약사항 및 가정

### 6.1 제약사항

1. **결재 요청 삭제 불가**: 한 번 생성된 결재 요청은 삭제할 수 없으며, 반려를 통해서만 종료 가능
2. **직원 정보 수정 제한**: 직원의 이름은 수정 불가, 부서와 직책만 수정 가능
3. **결재 단계 순서**: 결재 단계는 반드시 1부터 시작하여 오름차순으로 구성
4. **순차적 결재**: 결재는 단계별로 순차적으로 진행되며, 병렬 결재 불가

### 6.2 가정

1. 직원 ID는 시스템 전체에서 고유하다고 가정
2. 결재 요청 생성 시점에 모든 결재자가 시스템에 등록되어 있다고 가정
3. 네트워크 연결은 안정적이라고 가정
4. 서비스 간 통신 실패 시 재시도 로직은 별도 구현 필요

---

## 7. 리스크 분석

| ID | 리스크 | 영향도 | 발생 가능성 | 대응 방안 |
|:---|:---|:---:|:---:|:---|
| R-001 | 서비스 간 통신 실패 | 높음 | 중간 | 재시도 로직 및 Circuit Breaker 패턴 적용 |
| R-002 | In-Memory 데이터 유실 | 높음 | 높음 | 서비스 재시작 시 MongoDB에서 pending 상태 복구 |
| R-003 | WebSocket 연결 끊김 | 중간 | 중간 | 재연결 로직 및 미전송 알림 큐잉 |
| R-004 | 동시성 문제 | 중간 | 중간 | 분산 락 또는 낙관적 락 적용 검토 |

---

## 8. 배점 및 평가 기준

| 서비스 | 배점 | 평가 항목 |
|:---|:---:|:---|
| Employee Service | 20점 | REST API 구현, MySQL 연동, CRUD 기능 |
| Approval Request Service | 30점 | REST API, MongoDB 연동, gRPC 클라이언트, 비즈니스 로직 |
| Approval Processing Service | 30점 | REST API, gRPC 서버, In-Memory 관리, 결재 처리 로직 |
| Notification Service | 20점 | WebSocket 연결 관리, 실시간 알림 전송 |
| **기본 점수 합계** | **100점** | |
| 쿠버네티스 배포 (선택) | +10점 | Dockerfile, K8s Manifest |
| 비동기 메시지 통신 (선택) | +10점 | Kafka/RabbitMQ 적용 |
| 창의 영역 (선택) | +30점 | 추가 기능 제안 및 구현 |
